<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Simple Router for HTTP and WebSocket Requests • routr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="A Simple Router for HTTP and WebSocket Requests">
<meta name="description" content="In order to make sure that web request ends up in the correct handler function a router is often used. routr is a package implementing a simple but powerful routing functionality for R based servers. It is a fully functional fiery plugin, but can also be used with other httpuv based servers.">
<meta property="og:description" content="In order to make sure that web request ends up in the correct handler function a router is often used. routr is a package implementing a simple but powerful routing functionality for R based servers. It is a fully functional fiery plugin, but can also be used with other httpuv based servers.">
<meta property="og:image" content="https://routr.data-imaginist.com/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">routr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Release notes</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.data-imaginist.com/2017/introducing-routr/">Version 0.2.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="news/index.html">Change log</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://fiery.data-imaginist.com">fiery</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://reqres.data-imaginist.com">reqres</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/thomasp85/routr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="routr-">routr <a class="anchor" aria-label="anchor" href="#routr-"></a>
</h1>
</div>
<!-- badges: start -->

<p>routr is a simple and versatile router for R based web servers. For people not familiar with back-end development, a router is a piece of middleware that delegates HTTP requests to the correct handler function. The delegation is based in the URL of the request and in essence means that requests directed at <em>/persons/thomas/</em> ends up in another handler than <em>/packages/routr/</em>.</p>
<p>routr is heavily inspired by other routers build for other platforms, especially those for <a href="https://github.com/expressjs" class="external-link">Express.js</a> and <a href="https://github.com/rails/rails" class="external-link">Ruby on Rails</a>, though it doesn’t mimick either.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p><code>routr</code> is available on CRAN and can be installed in the regular way.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'routr'</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively you can grab the development version from Github with</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages('devtools')</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'thomasp85/routr'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="functionality">Functionality<a class="anchor" aria-label="anchor" href="#functionality"></a>
</h2>
<p>A router is build up of several seperate routes that are collected in a route stack. The stack recieves the request and passes it on to the first route in the stack. Depending on whether the route can handle the request and whether the handler signals a fall-through, the request is passed along the stack until a handler signals that no further processing should be done. This means that it is possible to stack different functionality like user verification, static resource serving, etc. on top of each other.</p>
<div class="section level3">
<h3 id="the-handler">The handler<a class="anchor" aria-label="anchor" href="#the-handler"></a>
</h3>
<p>A handler is a function that accepts the arguments <code>request</code>, <code>response</code>, <code>keys</code>, and <code>...</code>. The handler must return a boolean indicating if the request should be passed down the stack (<code>TRUE</code>) or not (<code>FALSE</code>). <code>routr</code> uses the <a href="https://github.com/thomasp85/reqres#reqres" class="external-link"><code>reqres</code></a> package to provide powerful request and response classes that makes it easy to work with an HTTP exchange. An example of a simple handler is:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span>, <span class="va">keys</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fl">200L</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">'html'</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">body</span> <span class="op">&lt;-</span> <span class="st">'&lt;h1&gt;Hello World!&lt;/h1&gt;'</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>No matter the content of the request passed to this handler it will return a “Hello World!” to the client. Because it returns <code>FALSE</code> it block any other handlers below it to modify the response.</p>
</div>
<div class="section level3">
<h3 id="the-route">The route<a class="anchor" aria-label="anchor" href="#the-route"></a>
</h3>
<p>A route is a collection of handlers. For any given request, only one handler in the route will be called. A route is an object of the R6 Route class and can be created as so:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">route</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/Route-class.html">Route</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">route</span><span class="op">$</span><span class="fu">add_handler</span><span class="op">(</span><span class="st">'get'</span>, <span class="st">'/hello/:what/'</span>, <span class="va">h</span><span class="op">)</span></span></code></pre></div>
<p>The first argument to <code>add_handler</code> defines the <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods" class="external-link">request type</a> while the second defines the path that the handler responds to. The path need not be static. In the above example the <code>:what</code> defines a variable meaning that the handler will respond to any <code>/hello/&lt;something&gt;/</code> variation. The variable and the value is available to the handler in the keys argument. For instance, if a request with the URL <code>/hello/mars/</code> were passed through the route, the keys argument passed to the handler would contain <code>list(what = 'mars')</code>. Variables can only span a single level, meaning that the above handler would not respond to <code>/hello/jupiter/saturn/</code>. To match to anything use <code>/hello/*</code> for responding to any sub-URL to <code>hello</code>. Matches to <code>*</code> will not end up in the keys list. If several paths in a route matches a URL the most specific will be used, meaning that <code>/*</code> will match everything but will always chosen last. With all that in mind lets change the handler to respond to the <code>what</code> variable:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span>, <span class="va">keys</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fl">200L</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">'html'</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">body</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'&lt;h1&gt;Hello '</span>, <span class="va">keys</span><span class="op">$</span><span class="va">what</span>, <span class="st">'!&lt;/h1&gt;'</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">route</span><span class="op">$</span><span class="fu">add_handler</span><span class="op">(</span><span class="st">'get'</span>, <span class="st">'/hello/:what/'</span>, <span class="va">h</span><span class="op">)</span></span></code></pre></div>
<p>Let’s also add a fallback handler that captures everything:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hFallback</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span>, <span class="va">keys</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fl">200L</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">'html'</span></span>
<span>    <span class="va">response</span><span class="op">$</span><span class="va">body</span> <span class="op">&lt;-</span> <span class="st">'&lt;h1&gt;I\'m not saying hello to you&lt;/h1&gt;'</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">route</span><span class="op">$</span><span class="fu">add_handler</span><span class="op">(</span><span class="st">'get'</span>, <span class="st">'/*'</span>, <span class="va">hFallback</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-route-stack">The route stack<a class="anchor" aria-label="anchor" href="#the-route-stack"></a>
</h3>
<p>The route stack manages several routes and takes care of receiving a request and returning a response. A route stack is an object of the R6 class <code>RouteStack</code> and is created like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">router</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/RouteStack.html">RouteStack</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">router</span><span class="op">$</span><span class="fu">add_route</span><span class="op">(</span><span class="va">route</span>, <span class="st">'test'</span><span class="op">)</span></span></code></pre></div>
<p>The order in which routes are added to the stack determines the calling order, with those added first taking precedence over those added later. Request are handled by the <code>dispatch</code> method like so:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">router</span><span class="op">$</span><span class="fu">dispatch</span><span class="op">(</span><span class="va">request</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-with-fiery">Use with fiery<a class="anchor" aria-label="anchor" href="#use-with-fiery"></a>
</h3>
<p>A <code>RouteStack</code> is a <a href="https://github.com/thomasp85/fiery" class="external-link">fiery</a>-compliant plugin meaning that it can be passed to the <code><a href="https://rdrr.io/r/base/attach.html" class="external-link">attach()</a></code> method of a fiery server. This will set the server up to pass requests through the route stack and use the resulting response automatically</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="fu">fiery</span><span class="fu">::</span><span class="va"><a href="https://fiery.data-imaginist.com/reference/Fire.html" class="external-link">Fire</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">app</span><span class="op">$</span><span class="kw">attach</span><span class="op">(</span><span class="va">router</span><span class="op">)</span></span>
<span><span class="va">app</span><span class="op">$</span><span class="fu">ignite</span><span class="op">(</span>block <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># In Terminal (or visit in browser)</span></span>
<span><span class="co"># curl http://127.0.0.1:8080/hello/mars/</span></span>
<span><span class="co"># &lt;h1&gt;Hello Mars!&lt;/h1&gt;</span></span>
<span><span class="va">app</span><span class="op">$</span><span class="fu">extinguish</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>By default the router responds to <code>request</code> events but can also be used to dispatch on <code>header</code> and <code>message</code> events. In the latter case the request that is send through the handlers is a modified version of the request used to establish the WebSocket version. If used as a WebSocket router a way to extract the path to dispatch on must be provided as part of the <code>RouteStack</code> construction.</p>
</div>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the ‘routr’ project is released with a <a href="https://routr.data-imaginist.com/CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=routr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/thomasp85/routr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/thomasp85/routr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing routr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a> <br><small class="roles"> Maintainer, author </small> <a href="https://orcid.org/0000-0002-5147-4711" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://github.com/thomasp85/routr/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/thomasp85/routr/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://CRAN.R-project.org/package=routr" class="external-link"><img src="https://www.r-pkg.org/badges/version/routr" alt="CRAN status"></a></li>
<li><a href="https://app.codecov.io/gh/thomasp85/routr" class="external-link"><img src="https://codecov.io/gh/thomasp85/routr/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
